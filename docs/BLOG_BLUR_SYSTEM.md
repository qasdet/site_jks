# Система замыливания текста в блоге

## Описание

Система замыливания текста позволяет защитить контент постов паролем, при этом показывая замыленную версию текста до ввода правильного пароля. Это дает пользователям представление о содержании поста, но не раскрывает полную информацию.

## Функциональность

### 1. Замыливание текста
- Текст постов с паролем автоматически замыливается
- Замыливание происходит на уровне символов внутри слов
- Короткие слова (2 символа и меньше) остаются без изменений
- Используются специальные символы замыливания: █, ▓, ▒, ░, ▄, ▌, ▐, ▀

### 2. Отображение в списках
- В списке постов (главная страница блога) показывается замыленный контент
- Добавлена индикация защищенных постов
- Пользователи видят, что пост защищен паролем

### 3. Просмотр поста
- При просмотре отдельного поста показывается замыленный контент
- Под контентом отображается форма для ввода пароля
- После ввода правильного пароля показывается полный текст

### 4. Доступ к контенту
- Автор поста всегда видит полный текст
- Пользователи с правильным паролем получают доступ на 24 часа
- Доступ сохраняется в сессии и базе данных

## Техническая реализация

### Функции в `utils/content_password.py`

#### `blur_text(text, blur_ratio=0.7)`
Замыливает текст, заменяя часть символов на символы замыливания.

**Параметры:**
- `text` (str): Исходный текст
- `blur_ratio` (float): Коэффициент замыливания (0.0 - 1.0)

**Возвращает:**
- `str`: Замыленный текст

#### `get_blurred_content(content_type, content_id, original_content)`
Возвращает замыленный контент, если пост защищен паролем и у пользователя нет доступа.

**Параметры:**
- `content_type` (str): Тип контента ('post', 'voting', 'topic')
- `content_id` (int): ID контента
- `original_content` (str): Исходный контент

**Возвращает:**
- `str`: Замыленный контент или исходный контент

### Изменения в маршрутах

#### `blog/routes.py`

1. **Главная страница блога (`/blog/`)**
   - Обрабатывает посты для отображения замыленного контента
   - Передает информацию о защите паролем

2. **Просмотр поста (`/blog/post/<id>`)**
   - Показывает замыленный контент для защищенных постов
   - Отображает форму ввода пароля
   - Передает информацию о доступе

3. **Мои посты (`/blog/my-posts`)**
   - Аналогично главной странице, но для постов пользователя

4. **Посты пользователя (`/blog/user/<id>`)**
   - Показывает замыленный контент для чужих постов

### Изменения в шаблонах

#### `templates/blog/post.html`
- Отображает замыленный контент вместо полного
- Показывает форму ввода пароля для защищенных постов
- Добавлена стилизация формы пароля

#### `templates/blog/index.html`
- Показывает замыленный контент в списке постов
- Добавлена индикация защищенных постов
- Обновлен JavaScript для удаления постов

## Использование

### Для авторов постов
1. Создайте пост как обычно
2. Перейдите к посту и нажмите кнопку "Пароль"
3. Установите пароль для защиты контента
4. Пост будет автоматически замылен для других пользователей

### Для читателей
1. В списке постов защищенные посты помечены индикатором
2. При просмотре поста виден замыленный контент
3. Введите пароль в форму под контентом
4. После ввода правильного пароля увидите полный текст

## Безопасность

- Пароли хешируются с использованием bcrypt
- Доступ сохраняется на 24 часа
- Авторы постов всегда имеют полный доступ
- Замыливание происходит на сервере, не в браузере

## Настройка

### Коэффициент замыливания
Можно изменить степень замыливания в функции `get_blurred_content`:
```python
return blur_text(original_content, blur_ratio=0.6)  # Измените значение
```

### Символы замыливания
Можно изменить символы в функции `blur_text`:
```python
blur_chars = ['█', '▓', '▒', '░', '▄', '▌', '▐', '▀']  # Добавьте или измените символы
```

## Совместимость

Система замыливания работает со всеми существующими постами:
- Посты без пароля отображаются как обычно
- Посты с паролем автоматически замыливаются
- Существующие пароли продолжают работать 